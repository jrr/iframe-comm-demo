<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <script>
    function sendMessageToIframe() {
      console.log("Outside: sendMessageToIframe()");
      i = document.querySelector("iframe");
      i.contentWindow.postMessage("hello from parent", "*");
    }
    window.addEventListener(
      "message",
      (event) => {
        console.log("Received event:");
        try {
          console.log(`event.source.document.URL=${event.source.document.URL}`);
        } catch (e) {
          console.log(e);
        }
        console.log(`origin=${event.origin}`);
        document.getElementById("message-buffer").append(event.data + "\n");
      },
      false
    );
    let iframeUrls = {
      local: "iframe.html",
      github: "https://jrr.github.io/iframe-comm-demo/iframe.html",
      gitlab: "https://john-ruble.gitlab.io/iframe-comm-demo/iframe.html",
    };
    function renderIframe(which) {
      var iframe = document.createElement("iframe");
      iframe.src = iframeUrls[which];
      let iframeHolder = document.getElementById("iframe-goes-here");
      iframeHolder.innerHTML = "";
      iframeHolder.appendChild(iframe);
    }
  </script>

  <body>
    <h1>iframe communication</h1>
    <p>
      This is a demo of communication across an iframe boundary. For
      demonstration purposes it's hosted at two different places:
    </p>
    <ul>
      <li>https://jrr.github.io/iframe-comm-demo/</li>
      <li>https://john-ruble.gitlab.io/iframe-comm-demo/</li>
    </ul>

    <div>
      Render iframe:
      <button onclick="renderIframe('local')">local</button>
      <button onclick="renderIframe('github')">github</button>
      <button onclick="renderIframe('gitlab')">gitlab</button>
    </div>

    <br />

    <table width="100%" height="50%" border="1">
      <thead>
        <th>Outside</th>
        <th>Iframe</th>
      </thead>
      <tr>
        <td width="50%">
          <p id="page-id"></p>
          <button onclick="sendMessageToIframe()">
            Send Message To Iframe
          </button>
          <hr />
          <pre id="message-buffer" />
        </td>
        <td width="50%" id="iframe-goes-here">(iframe goes here)</td>
      </tr>
    </table>

    <script>
      document.getElementById("page-id").innerText = `(${document.URL})`;
    </script>
  </body>
</html>
