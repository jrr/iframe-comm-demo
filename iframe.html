<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <script>
    window.addEventListener(
      "message",
      (event) => {
        console.log("Iframe received event:", {
          data: event.data,
          origin: event.origin,
        });

        // try {
        //   // cannot access document from a cross-origin message
        //   console.log(`event.source.document.URL=${event.source.document.URL}`);
        // } catch (e) {
        //   console.log(e);
        // }

        document.getElementById("message-buffer").append(event.data + "\n");
      },
      false
    );

    function sendMessageToParent() {
      window.parent.postMessage("Hello from iframe!", "*");
    }
  </script>

  <body>
    <p id="page-id"></p>

    <a href="https://jrr.github.io/iframe-comm-demo/iframe.html">github</a>
    <a href="https://john-ruble.gitlab.io/iframe-comm-demo/iframe.html"
      >gitlab</a
    >

    <button onclick="sendMessageToParent()">Send message to parent</button>
    <hr />

    <pre id="message-buffer" />

    <script>
      document.getElementById("page-id").innerText = `(${document.URL})`;
    </script>
  </body>
</html>
